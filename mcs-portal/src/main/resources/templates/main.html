<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head th:include="head"></head>
<title>集成播控平台V4</title>

<script type="text/javascript">
/*<![CDATA[*/
    $(document).ready(function() {
        $.ajax({
            type: 'POST',
            dataType: "json",
            url:'/getMenu?pid=-1',
            success: function(data){
                $.each(data,function(i,n){
                    var flag = false;
                    if(i == 0){
                        flag = true;
                    }
                    $('#menu').accordion('add',{
                        title: n.text,
                        selected: flag,
                        content:'<div style="padding:10px"><ul id="tree'+n.id+'"></ul></div>'
                    });

                    $("#tree" + n.id).tree({
                        animate:true,
                        lines:true,
                        url: '/getMenu?pid=' + n.id,
                        onBeforeExpand:function(node,param){
                            $("#tree" + n.id).tree('options').url = "/getMenu?pid=" + node.id;
                        },
                        onClick:function(node){
                            if(node.attributes.url != ''){
                                var opts = {
                                    title : node.text,
                                    border : false,
                                    closable : true,
                                    fit : true,
                                    iconCls : node.iconCls
                                };
                                var url = node.attributes.url;
                                if (url) {
                                    addIframe(node.text,url);
                                }
                            }
                        }
                    });
                });
            }
        });

        function addIframe(title, url) {
            var t = $('#tabs');
            if (t.tabs('exists', title)) {
                t.tabs('select', title);
            } else {
                var content = '未实现';
                if (url){
                    content = '<iframe scrolling="no" frameborder="0"  src="'+url+'" style="width:100%;height:100%;"></iframe>';
                }
                $('#tabs').tabs('addIframeTab', {
                    tab:{
                        title:title,
                        closable:true
                    },
                    iframe:{
                        src:url,
                        delay:'fast',
                        message:'加载中,请稍后...'
                    }
                });
            }
        }
    });

/*]]>*/
</script>

<body>
    <div id="main_layout" class="easyui-layout" data-options="fit:true,border:false">
        <div data-options="region:'north'" class="header">
            <div class="topleft">
<!--
                <a href="#" target="_parent"><img src="images/logo.png" title="系统首页" /></a>
-->
            </div>
            <div class="topright">
                <div class="user">
                    <span th:text="${session.user.userName}"></span>
                    <i><a href="/logout" target="_parent">退出</a></i>
                </div>
            </div>
        </div>

        <div data-options="region:'west'" title="菜单" style="width:200px;">
            <div id="menu" class="easyui-accordion"  data-options="fit:true,border:false"> </div>
        </div>

        <div data-options="region:'center',iconCls:'icon-ok'">
            <div id="tabs" class="easyui-tabs" data-options="fit:true,border:false">
            </div>
        </div>
    </div>
</body>

</html>